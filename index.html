<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kathyå•è¯å¤§å¸ˆè®­ç»ƒè¥</title>
    
    <!-- å¼•å…¥Supabaseåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>
    
    <!-- å¼•å…¥CSSæ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="style.css">
    
    <style>
        /* æ·»åŠ ä¸€äº›ä¸´æ—¶æ ·å¼ç¡®ä¿åŸºæœ¬æ˜¾ç¤º */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-family: Arial, sans-serif;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ç¡®ä¿åŸºç¡€æ ·å¼åŠ è½½å‰æœ‰åŸºæœ¬æ˜¾ç¤º */
        .container {
            display: none;
        }
    </style>
</head>
<body>
    <!-- å…¨å±€åŠ è½½é®ç½© -->
    <div id="global-loading" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-message">æ­£åœ¨åŠ è½½...</div>
        <div style="color: #666; margin-top: 10px;" id="loading-details"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>âš¡ Kathyå•è¯å¤§å¸ˆè®­ç»ƒè¥</h1>
            <h2 style="color: white;">ğŸ‘­å’Œå•è¯åšæœ‹å‹ğŸ§¡</h2>
            <p style="color: #BDC3C7; font-size: 0.9em;">ğŸ‘‘ æ•™å¸ˆï¼šKathy | ğŸ’¬ å¾®ä¿¡ï¼šKathy151</p>
        </div>
        
        <div class="main-content">
            <!-- ç™»å½•ç•Œé¢ -->
            <div id="login-screen" class="screen active">
                <div style="text-align: center;">
                    <h2>ğŸ‘‘ æ¬¢è¿ä½¿ç”¨å•è¯è®­ç»ƒç³»ç»Ÿ</h2>
                    <p style="color: #666; margin-bottom: 30px;">ğŸ§¡Kathyé™ªä½ ä¸€èµ·å’Œå•è¯ç©æ¸¸æˆğŸ§¡</p>
                    
                    <div style="margin: 30px 0;">
                        <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" autofocus>
                        <div id="login-message" class="message-box message-info">
                            æ­£åœ¨è¿æ¥ç³»ç»Ÿ...
                        </div>
                        
                        <div style="margin: 25px 0;">
                            <button class="btn" id="login-btn">ğŸ”‘ ç™»å½•/æ³¨å†Œ</button>
                            <button class="btn btn-blue" id="test-btn">æµ‹è¯•è¿æ¥</button>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 25px; margin: 30px 0;">
                        <h3 style="color: #2C3E50; margin-bottom: 20px;">ğŸ“± ä½¿ç”¨è¯´æ˜</h3>
                        <div class="card-grid">
                            <div class="stat-card">
                                <div style="font-size: 2em;">ğŸ‘©â€ğŸ«</div>
                                <div style="font-weight: bold; margin: 10px 0;">Kathyæ•™å¸ˆç«¯</div>
                                <div>å…³æ³¨å®ä»¬æ¯å¤©å•è¯è¿›åº¦</div>
                                <div>ä»Šå¤©ä½ å’Œå•è¯ç©æ¸¸æˆäº†ä¹ˆï¼Ÿ</div>
                            </div>
                            <div class="stat-card">
                                <div style="font-size: 2em;">ğŸ“</div>
                                <div style="font-weight: bold; margin: 10px 0;">å­¦ç”Ÿè´¦å·</div>
                                <div>Kathyå•ç‹¬å‘é€</div>
                                <div>åå­—é¦–å­—æ¯è¦å¤§å†™å“¦</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 25px;">
                            <div class="wechat-badge">
                                <span>ğŸ“ æ•™å¸ˆå¾®ä¿¡ï¼š</span>
                                <strong>Kathy151</strong>
                            </div>
                            <p style="color: #555; margin-top: 15px;">æœ‰ä»»ä½•é—®é¢˜è¯·éšæ—¶è”ç³»è€å¸ˆ</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ•™å¸ˆä¸»ç•Œé¢ -->
            <div id="teacher-screen" class="screen">
                <div class="fixed-header">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h2 style="margin: 0; color: #333;">ğŸ‘‘ æ•™å¸ˆç®¡ç†é¢æ¿</h2>
                        <button class="btn btn-red" onclick="handleLogout()" style="padding: 8px 16px;">
                            <span>ğŸšª é€€å‡º</span>
                        </button>
                    </div>
                </div>
                
                <div class="content-padding">
                    <div id="teacher-stats" class="stats-card">
                        <h3 style="color: #9C27B0; margin-bottom: 20px;">ğŸ“Š ç³»ç»Ÿæ¦‚è§ˆ</h3>
                        <div class="card-grid">
                            <div class="stat-card">
                                <div class="number" id="total-words">0</div>
                                <div class="label">å•è¯æ€»æ•°</div>
                            </div>
                            <div class="stat-card">
                                <div class="number" id="total-students">0</div>
                                <div class="label">å­¦ç”Ÿæ€»æ•°</div>
                            </div>
                            <div class="stat-card">
                                <div class="number" id="mastered-words">0</div>
                                <div class="label">å·²æŒæ¡å•è¯</div>
                            </div>
                            <div class="stat-card">
                                <div class="number" id="active-students">0</div>
                                <div class="label">æ´»è·ƒå­¦ç”Ÿ</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                            <button class="btn btn-purple" onclick="showUploadWordsPage()" style="height: 80px; font-size: 18px;">
                                <div>ğŸ“</div>
                                <div>ä¸Šä¼ å•è¯</div>
                            </button>
                            <button class="btn btn-blue" onclick="showGroupManagementPage()" style="height: 80px; font-size: 18px;">
                                <div>ğŸ‘¥</div>
                                <div>åˆ†ç»„ç®¡ç†</div>
                            </button>
                            <button class="btn" onclick="showAllStudentsPage()" style="height: 80px; font-size: 18px;">
                                <div>ğŸ“‹</div>
                                <div>æ‰€æœ‰å­¦ç”Ÿ</div>
                            </button>
                            <button class="btn btn-gold" onclick="showLearningProgressPage()" style="height: 80px; font-size: 18px;">
                                <div>ğŸ“Š</div>
                                <div>å­¦ä¹ è¿›åº¦</div>
                            </button>
                            <button class="btn" onclick="showWordManagementPage()" style="height: 80px; font-size: 18px;">
                                <div>ğŸ“–</div>
                                <div>å•è¯ç®¡ç†</div>
                            </button>
                            <button class="btn" onclick="showShareSystemPage()" style="height: 80px; font-size: 18px;">
                                <div>ğŸ”—</div>
                                <div>åˆ†äº«ç³»ç»Ÿ</div>
                            </button>
                        </div>
                    </div>
                    
                    <div id="teacher-content">
                        <!-- æ•™å¸ˆåŠŸèƒ½å†…å®¹åŒº -->
                    </div>
                </div>
            </div>
            
            <!-- å­¦ç”Ÿä¸»ç•Œé¢ -->
            <div id="student-screen" class="screen">
                <div class="fixed-header">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2 style="margin: 0; color: #333;">ğŸ“ æ¬¢è¿ï¼Œ<span id="student-name"></span>ï¼</h2>
                            <div style="display: flex; align-items: center; gap: 15px; margin-top: 5px;">
                                <div id="clock-in-status" style="background: #4CAF50; color: white; padding: 5px 10px; border-radius: 15px; font-size: 14px;">
                                    âœ… ä»Šæ—¥å·²æ‰“å¡
                                </div>
                                <div style="color: #666; font-size: 14px;">
                                    <span id="consecutive-days">0</span> å¤©è¿ç»­å­¦ä¹ 
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-red" onclick="handleLogout()" style="padding: 8px 16px;">
                            <span>ğŸšª é€€å‡º</span>
                        </button>
                    </div>
                </div>
                
                <div class="content-padding">
                    <!-- ä»Šæ—¥å­¦ä¹ æƒ…å†µ -->
                    <div id="today-status" style="margin-bottom: 30px;">
                        <!-- åŠ¨æ€åŠ è½½ä»Šæ—¥æ•°æ® -->
                    </div>
                    
                    <!-- æˆ‘çš„å­¦ä¹ è¿›åº¦ -->
                    <div id="my-progress-summary" class="stats-card" style="margin-bottom: 30px;">
                        <h3 style="color: #2196F3; margin-bottom: 20px;">ğŸ“Š æˆ‘çš„å­¦ä¹ è¿›åº¦</h3>
                        <!-- åŠ¨æ€åŠ è½½è¿›åº¦æ•°æ® -->
                    </div>
                    
                    <!-- å¿«é€Ÿæ“ä½œæŒ‰é’® -->
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 25px; margin-bottom: 30px;">
                        <h3 style="color: #333; margin-bottom: 20px; text-align: center;">ğŸš€ å¿«é€Ÿå¼€å§‹</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <button class="btn" onclick="dailyClockIn()" style="height: 80px; font-size: 18px;">
                                <div>ğŸ“…</div>
                                <div>æ¯æ—¥æ‰“å¡</div>
                            </button>
                            
                            <button class="btn" onclick="showTrainingOptions()" style="height: 80px; font-size: 18px;">
                                <div>ğŸ¯</div>
                                <div>å¼€å§‹è®­ç»ƒ</div>
                            </button>
                            
                            <button class="btn btn-blue" onclick="showClockInStats()" style="height: 80px; font-size: 18px;">
                                <div>ğŸ“Š</div>
                                <div>å­¦ä¹ ç»Ÿè®¡</div>
                            </button>
                            
                            <button class="btn" onclick="showMyWordListPage()" style="height: 80px; font-size: 18px;">
                                <div>ğŸ“–</div>
                                <div>æˆ‘çš„å•è¯æœ¬</div>
                            </button>
                            
                            <button class="btn" onclick="startReviewTraining()" style="height: 80px; font-size: 18px;">
                                <div>ğŸ”„</div>
                                <div>å¤ä¹ å¼±é¡¹</div>
                            </button>
                            
                            <button class="btn" onclick="showReviewPlan()" style="height: 80px; font-size: 18px; grid-column: span 2;">
                                <div>ğŸ“‹</div>
                                <div>æ™ºèƒ½å¤ä¹ </div>
                            </button>
                            
                            <button class="btn btn-gold" onclick="manualSyncWords()" style="height: 80px; font-size: 18px; grid-column: span 2;">
                                <div>ğŸ”„</div>
                                <div>ç«‹å³åŒæ­¥</div>
                            </button>
                        </div>
                    </div>
                    
                    <!-- æˆ‘çš„åˆ†ç»„è¯¦æƒ… -->
                    <div id="group-details" style="margin-bottom: 30px;">
                        <!-- åŠ¨æ€åŠ è½½åˆ†ç»„è¯¦æƒ… -->
                    </div>
                </div>
            </div>
            
            <!-- å…¶ä»–é¡µé¢ä¿æŒä¸å˜... -->
            <!-- ç”±äºä»£ç å¤ªé•¿ï¼Œè¿™é‡Œçœç•¥äº†å…¶ä»–é¡µé¢çš„é‡å¤ä»£ç  -->
            <!-- ç¡®ä¿ä½ ä¿ç•™äº†æ‰€æœ‰å…¶ä»–é¡µé¢çš„div -->
            
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œæ­£åœ¨åˆå§‹åŒ–...');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('global-loading').style.display = 'flex';
            document.getElementById('loading-message').textContent = 'æ­£åœ¨åŠ è½½ç³»ç»Ÿ...';
            
            // ç¡®ä¿å®¹å™¨æ˜¾ç¤º
            setTimeout(() => {
                document.querySelector('.container').style.display = 'block';
            }, 100);
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            const loginBtn = document.getElementById('login-btn');
            const testBtn = document.getElementById('test-btn');
            
            if (loginBtn) {
                loginBtn.addEventListener('click', function() {
                    console.log('ç™»å½•æŒ‰é’®ç‚¹å‡»');
                    if (typeof handleLogin === 'function') {
                        handleLogin();
                    } else {
                        alert('JavaScriptæ–‡ä»¶å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åé‡è¯•');
                    }
                });
            }
            
            if (testBtn) {
                testBtn.addEventListener('click', function() {
                    console.log('æµ‹è¯•æŒ‰é’®ç‚¹å‡»');
                    if (typeof testDatabase === 'function') {
                        testDatabase();
                    } else {
                        alert('JavaScriptæ–‡ä»¶å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åé‡è¯•');
                    }
                });
            }
            
            // æ£€æŸ¥JSæ–‡ä»¶æ˜¯å¦å·²åŠ è½½
            setTimeout(() => {
                if (typeof handleLogin === 'function' && typeof testDatabase === 'function') {
                    console.log('JavaScriptå‡½æ•°å·²åŠ è½½');
                    document.getElementById('loading-message').textContent = 'ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ';
                    document.getElementById('global-loading').style.display = 'none';
                } else {
                    console.log('ç­‰å¾…JavaScriptåŠ è½½...');
                    document.getElementById('loading-message').textContent = 'æ­£åœ¨åŠ è½½JavaScriptæ–‡ä»¶...';
                    
                    // å¦‚æœ10ç§’åè¿˜æ²¡åŠ è½½ï¼Œæç¤ºç”¨æˆ·
                    setTimeout(() => {
                        if (typeof handleLogin !== 'function') {
                            document.getElementById('loading-message').textContent = 'åŠ è½½è¶…æ—¶ï¼Œè¯·åˆ·æ–°é¡µé¢';
                            document.getElementById('loading-details').textContent = 'å¦‚æœé—®é¢˜æŒç»­ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
                        }
                    }, 10000);
                }
            }, 2000);
        });
        
        // é¡µé¢é”™è¯¯å¤„ç†
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('é¡µé¢é”™è¯¯:', msg, 'åœ¨', url, lineNo);
            alert('ç³»ç»Ÿå‡ºç°é”™è¯¯: ' + msg + '\nè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            return false;
        };
        
        // ç½‘ç»œçŠ¶æ€ç›‘æ§
        window.addEventListener('online', function() {
            console.log('ç½‘ç»œå·²è¿æ¥');
            showAlert('ç½‘ç»œå·²æ¢å¤è¿æ¥', 'success');
        });
        
        window.addEventListener('offline', function() {
            console.log('ç½‘ç»œæ–­å¼€');
            showAlert('ç½‘ç»œè¿æ¥å·²æ–­å¼€ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™', 'warning');
        });
    </script>
    
    <!-- å¼•å…¥ä¸»JavaScriptæ–‡ä»¶ -->
    <script src="script.js"></script>
</body>
</html>